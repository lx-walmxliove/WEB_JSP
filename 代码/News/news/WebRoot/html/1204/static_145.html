        <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html>	<head>		<meta http-equiv="Content-Type" content="text/html; charset=gb2312">		<title>Insert title here</title>		<meta http-equiv="pragma" content="no-cache">		<meta http-equiv="cache-control" content="no-cache">		<meta http-equiv="expires" content="0">        <LINK rel=stylesheet type=text/css href="http://127.0.0.1:8080/news/css/hyperlink.css"></LINK>                        		<style type="text/css">#pre_content {	width: 90%;	margin-left: auto;	padding: 2px;	border-left: 1px solid green;	background-color: #FFF;	margin-top: 5px;	margin-right: auto;	text-align: justify;}        #content {	width: 950px;	margin-right: auto;	margin-left: auto;	background-color: #FFF;	margin-top: 5px;}        </style>	</head>	<body>		        <DIV style="WIDTH: 950px" id=tabsJ class=shadow><IMG       style="MARGIN-LEFT: 0px" src="http://127.0.0.1:8080/news/images/mispuppy.jpg" width=950>       <UL>        <LI id=current><A         href="http://127.0.0.1:8080/news/index.jsp"><SPAN>首页</SPAN></A>         <LI><A         href="http://127.0.0.1:8080/news/Item.jsp?id=16"><SPAN>Java</SPAN></A>         <LI><A         href="http://127.0.0.1:8080/news/Item.jsp?id=18"><SPAN>数据库</SPAN></A>         <LI><A         href="http://127.0.0.1:8080/news/Item.jsp?id=17"><SPAN>.Net</SPAN></A>         <LI><A         href="http://127.0.0.1:8080/news/Item.jsp?id=19"><SPAN>云计算</SPAN></A>         <LI><A         href="http://127.0.0.1:8080/news/Item.jsp?id=20"><SPAN>程序员</SPAN></A>         <LI><A         href="http://127.0.0.1:8080/news/Item.jsp?id=21"><SPAN>web开发</SPAN></A>         <LI><A         href="http://127.0.0.1:8080/news/index.jsp"><SPAN>管理员列表</SPAN></A>         <LI><A         href="http://127.0.0.1:8080/news/index.jsp"><SPAN>联系我们</SPAN></A>         </LI></UL></DIV><div id="content">		<div id="pre_content">			<div>				<h3 align="center">ASP.NET Session的七点认识</h3>				作者：admin&nbsp;&nbsp;&nbsp;&nbsp;日期：2012-04-17 15:53:00.0&nbsp;&nbsp;&nbsp;&nbsp;查看次数:0				<hr color="#66CCFF"/>                <DL>          <DD>                <div>				<span id="MasterContent1_article_content">&nbsp;<p><span style="font-size: medium">ASP.NET Session的使用当中我们会遇到很多的问题，那么这里我们来谈下经常出现的一些常用ASP.NET Session的理解：</span></p><p><span style="font-size: medium">ASP.NET Session的七点认识之一： </span><strong><br /></strong></p><p><span style="font-size: medium">对于值类型的变量,Session中保存的是值类型的拷贝</span></p><p>&nbsp;</p><table border="0" cellspacing="0" cellpadding="6" width="95%" align="center" style="border-bottom: #cccccc 1px dotted; border-left: #cccccc 1px dotted; table-layout: fixed; border-top: #cccccc 1px dotted; border-right: #cccccc 1px dotted">    <tbody>        <tr>            <td bgcolor="#fdfddf" style="word-wrap: break-word"><span style="font-size: medium">Session[&quot;__test0&quot;] = 1; int i = (int)Session[&quot;__test0&quot;]+1; int j = (int)Session[&quot;__test0&quot;]; 结果i=2,j=1</span></td>        </tr>    </tbody></table><p>&nbsp;</p><p>&nbsp;</p><p><span style="font-size: medium">ASP.NET Session的七点认识之二： </span><strong><br /></strong></p><p>&nbsp;</p><p><span style="font-size: medium">对于引用类新的变量,Session中保存的是引用</span></p><p>&nbsp;</p><table border="0" cellspacing="0" cellpadding="6" width="95%" align="center" style="border-bottom: #cccccc 1px dotted; border-left: #cccccc 1px dotted; table-layout: fixed; border-top: #cccccc 1px dotted; border-right: #cccccc 1px dotted">    <tbody>        <tr>            <td bgcolor="#fdfddf" style="word-wrap: break-word"><span style="font-size: medium"><font color="#ff0000"><font color="#000000">CDACommon cda = new CDACommon(); Session[&quot;__test&quot;] = cda.GetDataSet(&quot;select top 1 * from tb_customer&quot;); DataSet ds = (DataSet)Session[&quot;__test&quot;]; DataSet ds2 = (DataSet)Session[&quot;__test&quot;]; ds.Tables[0].Rows[0][0]=&quot;9999&quot;; 结果ds.Tables[0].Rows[0][0]==&quot;9999&quot; ds2.Tables[0].Rows[0][0]==&quot;9999&quot;;</font> </font></span></td>        </tr>    </tbody></table><p>&nbsp;</p><p>&nbsp;</p><p><span style="font-size: medium">ASP.NET Session的七点认识之三： </span><strong><br /></strong></p><p>&nbsp;</p><p><span style="font-size: medium">Session周期</span></p><p><span style="font-size: medium">新的浏览器窗口启动后，开始一个新的Session,触发Global的Session_Start的调用，从第一个浏览器窗口打开的浏览器窗口不 启动新的Session。Session过期后，执行页面的提交也会触发Session_Start，等于是新的一个Session。</span></p><p>&nbsp;</p><p>&nbsp;</p><p><span style="font-size: medium">ASP.NET Session的七点认识之四： </span><strong><br /></strong></p><p>&nbsp;</p><p><span style="font-size: medium">调用Session</span></p><p><span style="font-size: medium">对于Web Service，每个方法的调用都会启动一个Session，可以用下面的方法来使多个调用在同一个Session里</span></p><p><span style="font-size: medium">CWSSyscfg cwsCfg = new CWSSyscfg(); cwsCfg.CookieContainer = new System.Net.CookieContainer(); CWSSyscfg是一个Web Service类，Web Service的给代理类设置CookieContainer属性，只要多个代理的CookieContainer属性是相同的值，则对这些Web Service的调用在同一个Session。可以用单例模式来实现。</span></p><p>&nbsp;</p><p>&nbsp;</p><p><span style="font-size: medium">ASP.NET Session的七点认识之五： </span><strong><br /></strong></p><p>&nbsp;</p><p><span style="font-size: medium">Session数据有效期</span></p><p><span style="font-size: medium">只要页面有提交活动，则Session的所有项都会保持，页面在20分钟（默认配置）内没有任何提交活动时Session会失效。Session内存储的多个数据项是整体失效的。</span></p><p>&nbsp;</p><p>&nbsp;</p><p><span style="font-size: medium">ASP.NET Session的七点认识之六： </span><strong><br /></strong></p><p>&nbsp;</p><p><span style="font-size: medium">Session的保存</span></p><p><span style="font-size: medium">在session中如果保存的是非序列化的类比如DataView，在用SQLServer保存Session的模式下，无法使用。查看一个类是否是序列化的方法是，需看是否用[Serializable]来标记了该类。</span></p><p>&nbsp;</p><p>&nbsp;</p><p><span style="font-size: medium">ASP.NET Session的七点认识之七： </span><strong><br /></strong></p><p>&nbsp;</p><p><span style="font-size: medium">关于Sesson的清除。</span></p><p><span style="font-size: medium">如果我在Session中保存一个比较大的DataSet，这样aspnet_wp.exe占有的内存会很大，假如我退出了使用这个DataSet 的页面，我想释放该Session，我用Session.Clear() 或者DataSet.Clear()都 不能使内存的占用降下来，即使Session过了期限，内存也没有降下来，比较困惑，谁能给我详细解释一下。</span></p><p><span style="font-size: medium">要说到session这个东西，很多人可能都不屑一顾。这个东东嘛，n年前就开始做了，有啥好讲的啊。可是，在很多地方我们还是会发现一些问题，比 如有的人说，我的session_start激发了，怎么session_end没有啊，我在session_end做了些善后工作，这下没法完成了，怎 么办啊？</span></p><p><span style="font-size: medium">最近看了些文章，结合自己的一些经验，想和大家一起讨论一下其中的说法。</span></p><p><span style="font-size: medium">其实，很多这类的问题都是由一个东西引起的，它就是session ID。首先，是不是我一个IE client起来，访问一个页面，只要我不关浏览器，session ID就是一样的呢？很多人会想，应该是一样的吧，我浏览器都没关，web server总归会认为我是同一个client,不会把session ID变来变去的。要验证这个，让我们现在做一个简单的试验。用vs.net创建一个简单的asp.net web app.在web form1上加个button,然后在页面的page prefix上enable trace.接下来浏览这个页面，不停的click button来提交request。感谢asp.net的这个trace功能，我们可以看到session ID其实是在不停的变化的。也就是说，这时候在服务器端，根本就不关心这个client的存在，每次都觉得它是来自一个新的client.</span></p><p><span style="font-size: medium">那这到底是怎么回事呢？OK，让我们在page_load里面加上一句，session[&quot;variable1&quot;]=&quot;testvalue&quot;;然后 再做一下测试。Bingo,现在session ID就保持一致了。我想，很多人也许以前就没有注意到这点。这里我们可以得出一个结论:要建立一个持续的session，咱们需要至少使用一下 session变量，用行话来说，就是要至少往session dictionary中写入一次。</span></p><p><span style="font-size: medium">不过，值得注意的是，这只是个必要条件，还不是充分条件。</span></p><p><span style="font-size: medium">在提到下一个必要条件前，我们先来弄清一件事，如果我们在程序中间有global.asax,里面有session_onstart, session_onend，上面的实验是不会成功的。原因是一旦定义了session_onstart处理函数后,session的state就总是会 被保存了，即使里面是空的，这样的话，session ID就不会改变了。因为session这东西还是消耗资源的，所以在asp.net web app中如果没有必要，你就不要把session_onstart, session_end写在global.asax中。</span></p><p><span style="font-size: medium">上面的实验中,我们也可以看到,如果session ID在变化，我们就跟踪不到session_onend,一旦稳定下来，session_onend就出现了。</span></p><p><span style="font-size: medium">现在，我们再来谈谈另一个条件，还是先从实验做起，我们在刚才例子的基础上(包括session_onstart, session_onend)，在page_load的session那行的下面加上一句，session.abandon().再来运行一把,咦,这是 你会发现一点奇怪的地方,session_onend不执行了，尽管session_onstart执行过了一遍。（这里我们需要写一些log语句来观察 到）而且，如果我们把session.abandon()写在button.onclick事件里面，session_onend就立马执行了。奇怪吧， 这里有什么区别呢？</span></p><p><span style="font-size: medium">这样，第二个必要条件就引发了，要让session_onend成功执行，至少要有一个request已经被完整地执行过。上面的第一种情况，在page_load中就中止的话，第一个request都没有执行完毕，session_onend就没法激发了。</span></p><p>&nbsp;</p><p><span style="font-size: medium">综合这两个必要条件，我们终于可以得出要让session_onend执行的充分条件了：</span></p><p><span style="font-size: medium">至少有一个request成功完整地执行</span></p><p><span style="font-size: medium">至少存储一些data在session state中。可以通过session变量或者加上session_onstart来实现。</span></p><p><span style="font-size: medium">最后声明一点，session_onend只在InProc模式中支持，也就是说，只在session data在asp.net worker process中时支持。</span></p><p><span style="font-size: medium">ASP.NET Session的七点认识就谈到这里，对于ASP.NET Session的理解是不是有所帮助呢？</span></p><p><span style="font-size: medium">原文出自：</span><a href="http://www.52cfml.com/post/104.html" target="_blank"><span style="font-size: medium">52cfml</span></a></p></span>                </div>                </DD>                </DL>			</div>			<hr color="#66CCFF"/>		<a href="http://127.0.0.1:8080/news/article/cmtBoard.jsp?id=145">我要评论</a>		</div>  </div>        <TABLE align="center">        <TBODY>        <TR>          <TD>管理信息系统(MIS)开发实验室</TD></TR></TBODY></TABLE>	</body></html>
